// scripts/gen-cjs-wrapper.js
// This script generates dist/index.cjs as a CommonJS wrapper for the ESM build.
import { existsSync, mkdirSync, writeFileSync } from "node:fs";
import { dirname, join } from "node:path";
import { fileURLToPath } from "node:url";

const cjsWrapper = `// This file is automatically generated to provide CommonJS compatibility for deadslog.\nconst deadslog = require('./index.js').default;\nmodule.exports = deadslog;\n`;

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const distDir = join(__dirname, "../dist");
const outFile = join(distDir, "index.cjs");

if (!existsSync(distDir)) {
	mkdirSync(distDir, { recursive: true });
}

writeFileSync(outFile, cjsWrapper);
console.log("[deadslog/build] Generated dist/index.cjs CommonJS wrapper.");
